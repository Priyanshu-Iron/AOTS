<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Object Tracking App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Object Tracking App</h1>
        <img id="videoFeed" src="/video_feed" alt="Video Feed">
        <div class="controls">
            <button onclick="initCamera()">Initialize Camera</button>
            <button onclick="detectObjects()">Detect Objects</button>
            <button onclick="startTracking()">Start Tracking</button>
            <button onclick="stopTracking()">Stop Tracking</button>
        </div>
        <div id="status">Status: Idle</div>
        <div id="objects"></div>
    </div>

    <script>
        const video = document.getElementById('videoFeed');
        const status = document.getElementById('status');
        const objectsDiv = document.getElementById('objects');
        let selectedBbox = null;

        video.addEventListener('click', (e) => {
            const rect = video.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            // For simplicity, assume a fixed size bbox
            selectedBbox = [x - 25, y - 25, 50, 50];
            status.textContent = `Selected bbox: ${selectedBbox}`;
        });

        async function initCamera() {
            const response = await fetch('/init_camera', { method: 'POST' });
            const result = await response.json();
            status.textContent = result.status === 'success' ? 'Status: Camera Initialized' : `Status: ${result.message}`;
        }

        async function detectObjects() {
            const response = await fetch('/detect_objects', { method: 'POST' });
            const result = await response.json();
            if (result.status === 'success') {
                objectsDiv.innerHTML = '';
                result.objects.forEach((obj, index) => {
                    const div = document.createElement('div');
                    div.className = 'object-option';
                    div.textContent = `${obj.label} (Confidence: ${obj.confidence.toFixed(2)})`;
                    div.onclick = () => {
                        selectedBbox = obj.bbox;
                        status.textContent = `Selected ${obj.label} at ${selectedBbox}`;
                    };
                    objectsDiv.appendChild(div);
                });
            } else {
                status.textContent = `Status: ${result.message}`;
            }
        }

        async function startTracking() {
            if (!selectedBbox) {
                status.textContent = 'Status: Please select an object first';
                return;
            }
            const response = await fetch('/start_tracking', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ bbox: selectedBbox })
            });
            const result = await response.json();
            status.textContent = result.status === 'success' ? 'Status: Tracking Started' : `Status: ${result.message}`;
        }

        async function stopTracking() {
            const response = await fetch('/stop_tracking', { method: 'POST' });
            const result = await response.json();
            status.textContent = result.status === 'success' ? 'Status: Tracking Stopped' : `Status: ${result.message}`;
        }
    </script>
</body>
</html>